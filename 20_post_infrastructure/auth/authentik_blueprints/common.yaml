apiVersion: v1
kind: Secret
metadata:
  name: authentik-blueprint-common
  namespace: auth
type: Opaque
stringData:
  common.yaml: |
    # yaml-language-server: $schema=https://goauthentik.io/blueprints/schema.json
    version: 1
    metadata:
      name: Custom - Common Functionality
    entries:
      # Shared group all mail users can join
      - model: authentik_core.group
        id: mail-users
        identifiers: { name: mail-users }
        state: present
        attrs: { name: mail-users }

      - model: authentik_core.user
        identifiers: { username: service-noreply }
        state: present
        attrs:
          name: service-noreply
          email: noreply@${vals_info_cluster_domain}
          type: service_account
          is_active: true
          groups: [ !KeyOf mail-users ]
          path: goauthentik.io/service-accounts
          password: ${secrets_apps_mail_noreplysender_password}
          attributes:
            goauthentik.io/user/service-account: true
